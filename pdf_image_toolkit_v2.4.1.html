<!DOCTYPE html><html lang="cs"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>PDF & Image Toolkit - verze 2.4.1 | Autor: PB | Email: pavel.bartos.pb@gmail.com</title>
<style>
:root{--bg:#0b1020;--panel:#12182b;--muted:#91a0b3;--text:#e9eef7;--accent:#6aa3ff;--ok:#3ddc97;--warn:#ffb703;--bad:#ef476f;--border:rgba(255,255,255,.06);--border-soft:rgba(255,255,255,.1);--chip-bg:#0c1423;--btn:#1a2240;--btn-grad1:#2a5be9;--btn-grad2:#264fd0;--btn-border:#244ec0}
:root[data-theme=light]{--bg:#f5f7fb;--panel:#fff;--muted:#5b6776;--text:#0c1222;--accent:#2d6cdf;--ok:#2cae7f;--warn:#c98a05;--bad:#d33b5a;--border:rgba(12,18,34,.08);--border-soft:rgba(12,18,34,.12);--chip-bg:#eef2f8;--btn:#e7ecf6;--btn-grad1:#4f83ff;--btn-grad2:#3b6de6;--btn-border:#3b6de6}
html,body{height:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);transition:background .2s,color .2s}
.wrap{max-width:1120px;margin:0 auto;padding:24px}h1{font-size:28px;margin:0 0 10px}.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.sub{color:var(--muted);margin-bottom:16px}
.grid{display:grid;grid-template-columns:1.35fr .65fr;gap:18px}.card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.12)}
.drop{border:2px dashed var(--border);border-radius:14px;padding:22px;text-align:center;cursor:pointer;transition:.15s}.drop.dragover{background:rgba(0,0,0,.03);border-color:var(--accent)}
.btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}button{background:var(--btn);border:1px solid var(--border-soft);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}button.primary{background:linear-gradient(180deg,var(--btn-grad1),var(--btn-grad2));border-color:var(--btn-border);color:#fff}button:disabled{opacity:.55;cursor:not-allowed}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}.opt{display:flex;align-items:center;gap:8px;color:var(--muted)}input[type=range]{width:180px}
.list{max-height:340px;overflow:auto;margin-top:10px;border-top:1px dashed var(--border)}.item{display:flex;justify-content:space-between;gap:10px;padding:10px 0;border-bottom:1px dashed var(--border)}
.item .remove,.item .remove-att{background:#2a304a;border:1px solid var(--border-soft);border-radius:10px;padding:6px 10px}:root[data-theme=light] .item .remove,:root[data-theme=light] .item .remove-att{background:#ecf1fa}.item .remove:hover,.item .remove-att:hover{filter:brightness(1.07)}
.tag{font-size:12px;color:#9fb0c9;background:var(--chip-bg);border:1px solid var(--border);padding:2px 8px;border-radius:999px}:root[data-theme=light] .tag{color:#3b4a63}.page{font-weight:800;font-size:12px}.hint{font-size:13px;color:var(--muted)}
.log{font-family:ui-monospace,monospace;background:var(--chip-bg);border-radius:12px;padding:12px;min-height:120px;max-height:260px;overflow:auto;border:1px solid var(--border)}a.dl{color:var(--ok);text-decoration:none;font-weight:700}.footer{margin-top:18px;color:var(--muted);font-size:12px}
.section-title{font-weight:800;margin-top:12px;margin-bottom:6px}.cfg{display:grid;grid-template-columns:1fr 1fr;gap:12px}.field{display:flex;flex-direction:column;gap:6px}.field label{font-size:12px;color:var(--muted)}
input[type=password],input[type=text],select{background:var(--chip-bg);border:1px solid var(--border-soft);border-radius:10px;color:var(--text);padding:8px 10px}.themebtn{display:inline-flex;align-items:center;gap:8px}
.thumbwrap{width:105px;display:flex;flex-direction:column;align-items:center;gap:6px}.thumb{width:105px;height:105px;object-fit:cover;border-radius:12px;border:1px solid var(--border)}.thumbcap{font-size:11px;line-height:1.2;color:var(--muted);text-align:center;max-width:105px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.meta{display:flex;flex-direction:column;gap:4px}
.infobox{margin-top:12px;border-top:1px dashed var(--border);padding-top:12px}.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}.kv{display:flex;justify-content:space-between;gap:10px;border-bottom:1px dotted var(--border-soft);padding:6px 0}.kv b{opacity:.9}.att{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:6px 0;border-bottom:1px dotted var(--border-soft)}
</style>
<script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
</head>
<body><div class="wrap"><div class="topbar"><div><h1>PDF & Image Toolkit</h1><div class="sub">Drag & Drop PDF / JPG / PNG / SVG. V≈°e bƒõ≈æ√≠ lok√°lnƒõ v prohl√≠≈æeƒçi ‚Äì nic se nikam neodes√≠l√°. <span class="tag">v2.4.1</span> Autor: PB</div></div><div><button id="themeToggle" class="themebtn" title="P≈ôepnout tmav√Ω/svƒõtl√Ω re≈æim">üåì¬†<span id="themeLabel">Tmav√Ω</span></button></div></div>
<div class="grid"><div class="card">
<div class="section-title">Vstupn√≠ soubory (str√°nky)</div>
<div id="drop" class="drop"><strong>P≈ôet√°hnƒõte soubory sem</strong> nebo kliknƒõte pro v√Ωbƒõr
<input id="fileInput" type="file" accept="application/pdf,image/jpeg,image/png,image/svg+xml,.svg,.dwg" multiple hidden /></div>
<div class="section-title">P≈ô√≠lohy do v√Ωsledn√©ho PDF (voliteln√©)</div>
<div id="dropAttach" class="drop">P≈ôet√°hnƒõte libovoln√© soubory, kter√© maj√≠ b√Ωt vlo≈æeny jako <em>p≈ô√≠lohy</em> PDF (Attachments panel).
<input id="attachInput" type="file" multiple hidden /></div>
<div class="btns">
<button id="btnMerge" class="primary" disabled>1) Slouƒçit do jednoho PDF</button>
<button id="btnCompress" disabled>2) Komprimovat PDF</button>
<button id="btnSplit" disabled>3) Rozdƒõlit PDF na str√°nky (ZIP)</button>
<button id="btnPdfToJpg" disabled>4) PDF ‚Üí JPG (ZIP)</button>
<button id="btnInfo" disabled>5) INFO</button>
</div>
<div class="row" style="margin-top:12px">
<label class="opt"><input type="checkbox" id="fitA4" checked> p≈ôizp≈Øsobit obr√°zky na A4</label>
<label class="opt">Kvalita JPEG: <input type="range" id="jpgQuality" min="0.4" max="0.95" step="0.05" value="0.8"><span id="qLabel">0.80</span></label>
<label class="opt">DPI pro PDF‚ÜíJPG: <input type="range" id="dpi" min="72" max="220" step="4" value="144"><span id="dpiLabel">144</span></label>
</div>
<div class="section-title">Zabezpeƒçen√≠ (voliteln√©)</div>
<div class="cfg">
<div class="field"><label><input type="checkbox" id="optProtect"> Zaheslovat v√Ωstupn√≠ PDF (AES-256, vy≈æaduje QPDF/WASM)</label></div>
<div class="field"><label for="userPwd">Heslo pro otev≈ôen√≠ (user password)</label><input id="userPwd" type="password" placeholder="nap≈ô. 1234" disabled></div>
<div class="field"><label for="ownerPwd">Vlastnick√© heslo (owner, voliteln√©)</label><input id="ownerPwd" type="password" placeholder="ponechte pr√°zdn√© = stejn√© jako v√Ω≈°e" disabled></div>
<div class="field"><label for="keyLen">D√©lka kl√≠ƒçe</label><select id="keyLen" disabled><option value="256" selected>AES-256</option><option value="128">AES-128</option></select></div>
</div>
<div class="hint" style="margin-top:6px">Tipy: Slouƒçen√≠ podporuje mix PDF + obr√°zky (JPG/PNG/SVG). Komprese p≈ôevzorkuje str√°nky do JPEG (nejlep≈°√≠ pro skeny).<br>DWG se pokus√≠me rozpoznat ‚Äî pokud nen√≠ dostupn√° knihovna, je bezpeƒçnƒõ ignorov√°n.</div>
<div class="section-title" style="margin-top:10px">Seznam vstup≈Ø</div><div class="list" id="fileList"></div>
<div class="section-title" style="margin-top:10px">P≈ô√≠lohy</div><div class="list" id="attachList"></div>
</div>
<div class="card"><div class="row" style="justify-content:space-between;align-items:center"><div style="font-weight:700">Protokol</div><button id="btnClear">Vyƒçistit</button></div>
<div id="log" class="log"></div>
<div id="docInfo" class="infobox"></div>
<div class="footer">v2.4.1 ¬∑ Knihovny: pdf-lib, pdf.js, JSZip, FileSaver (+ volitelnƒõ qpdf-wasm pro ≈°ifrov√°n√≠). Autor: PB.</div>
</div></div></div>
<script>
const root=document.documentElement,themeToggle=document.getElementById('themeToggle'),themeLabel=document.getElementById('themeLabel');const storedTheme=localStorage.getItem('pdfit_theme')||'dark';root.dataset.theme=storedTheme;themeLabel.textContent=storedTheme==='light'?'Svƒõtl√Ω':'Tmav√Ω';themeToggle.addEventListener('click',()=>{const cur=root.dataset.theme==='light'?'dark':'light';root.dataset.theme=cur;localStorage.setItem('pdfit_theme',cur);themeLabel.textContent=cur==='light'?'Svƒõtl√Ω':'Tmav√Ω'});
pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js";
const drop=document.getElementById('drop'),fileInput=document.getElementById('fileInput'),dropAttach=document.getElementById('dropAttach'),attachInput=document.getElementById('attachInput'),fileListEl=document.getElementById('fileList'),attachListEl=document.getElementById('attachList'),logEl=document.getElementById('log'),infoEl=document.getElementById('docInfo');const btnMerge=document.getElementById('btnMerge'),btnCompress=document.getElementById('btnCompress'),btnSplit=document.getElementById('btnSplit'),btnPdfToJpg=document.getElementById('btnPdfToJpg'),btnInfo=document.getElementById('btnInfo'),btnClear=document.getElementById('btnClear');const fitA4=document.getElementById('fitA4'),jpgQuality=document.getElementById('jpgQuality'),qLabel=document.getElementById('qLabel'),dpi=document.getElementById('dpi'),dpiLabel=document.getElementById('dpiLabel');const optProtect=document.getElementById('optProtect'),userPwd=document.getElementById('userPwd'),ownerPwd=document.getElementById('ownerPwd'),keyLen=document.getElementById('keyLen');
jpgQuality.addEventListener('input',()=>qLabel.textContent=(+jpgQuality.value).toFixed(2));dpi.addEventListener('input',()=>dpiLabel.textContent=(dpi.value|0));optProtect.addEventListener('change',()=>{const on=optProtect.checked;[userPwd,ownerPwd,keyLen].forEach(el=>{el.disabled=!on})});
let items=[],attachments=[];function log(msg,type='info'){const color=type==='ok'?'var(--ok)':type==='warn'?'var(--warn)':type==='bad'?'var(--bad)':'var(--text)';const time=new Date().toLocaleTimeString();logEl.innerHTML+=`<div><span style="color:${color}">[${time}]</span> ${msg}</div>`;logEl.scrollTop=logEl.scrollHeight}
function refreshUI(){infoEl.innerHTML='';fileListEl.innerHTML=items.map((it,i)=>{let ext='JPG';if(it.type==='application/pdf')ext='PDF';else if(it.type.includes('png'))ext='PNG';else if(it.type.includes('svg'))ext='SVG';const size=(it.data.byteLength/1024/1024).toFixed(2)+' MB';const thumb=it.thumb?`<div class="thumbwrap"><img class="thumb" src="${it.thumb}" alt="thumb"><div class="thumbcap" title="${escapeHtml(it.name)}">${escapeHtml(it.name)}</div></div>`:'<div class="thumbwrap"></div>';return `<div class="item" data-idx="${i}" draggable="true"><div class="row" style="align-items:center;gap:12px"><span class="tag" style="cursor:grab" title="P≈ôet√°hnout pro zmƒõnu po≈ôad√≠">‚áÖ</span>${thumb}<div class="meta"><div class="page">Page ${i+1}</div><span class="tag">${ext}</span><div class="hint">${size}</div></div></div><button class="remove" title="Odstranit" aria-label="Odstranit">‚úï</button></div>`}).join('');attachListEl.innerHTML=attachments.map((it,i)=>{const size=(it.data.byteLength/1024/1024).toFixed(2)+' MB';return `<div class="item"><div class="row" style="align-items:center;gap:10px"><span class="tag">P≈ò√çLOHA</span><div><strong>${escapeHtml(it.name)}</strong><div class="hint">${size}</div></div></div><button class="remove-att" data-idx="${i}" title="Odstranit p≈ô√≠lohu">‚úï</button></div>`}).join('');const onlyPDF=items.length>0&&items.every(it=>it.type==='application/pdf');btnMerge.disabled=items.length===0;btnCompress.disabled=!onlyPDF||items.length!==1;btnSplit.disabled=!onlyPDF||items.length!==1;btnPdfToJpg.disabled=!onlyPDF||items.length!==1;btnInfo.disabled=!onlyPDF||items.length!==1;fileListEl.querySelectorAll('.remove').forEach((btn,i)=>{btn.addEventListener('click',()=>{items.splice(i,1);refreshUI()})});attachListEl.querySelectorAll('.remove-att').forEach(btn=>{btn.addEventListener('click',()=>{const i=+btn.dataset.idx;attachments.splice(i,1);refreshUI()})});enableReorder()}
function enableReorder(){let dragIdx=null;fileListEl.querySelectorAll('.item').forEach(el=>{el.addEventListener('dragstart',e=>{dragIdx=+el.dataset.idx;e.dataTransfer.effectAllowed='move'});el.addEventListener('dragover',e=>{e.preventDefault();e.dataTransfer.dropEffect='move'});el.addEventListener('drop',e=>{e.preventDefault();const dropIdx=+el.dataset.idx;if(dragIdx===null||dragIdx===dropIdx)return;const [m]=items.splice(dragIdx,1);items.splice(dropIdx,0,m);refreshUI()})})}
function escapeHtml(s){return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}
drop.addEventListener('click',()=>fileInput.click());drop.addEventListener('dragover',e=>{e.preventDefault();drop.classList.add('dragover')});drop.addEventListener('dragleave',()=>drop.classList.remove('dragover'));drop.addEventListener('drop',async e=>{e.preventDefault();drop.classList.remove('dragover');await handleFiles(e.dataTransfer.files)});fileInput.addEventListener('change',async e=>{await handleFiles(e.target.files);fileInput.value=''});
dropAttach.addEventListener('click',()=>attachInput.click());dropAttach.addEventListener('dragover',e=>{e.preventDefault();dropAttach.classList.add('dragover')});dropAttach.addEventListener('dragleave',()=>dropAttach.classList.remove('dragover'));dropAttach.addEventListener('drop',async e=>{e.preventDefault();dropAttach.classList.remove('dragover');await handleAttachments(e.dataTransfer.files)});attachInput.addEventListener('change',async e=>{await handleAttachments(e.target.files);attachInput.value=''});
function isDWGFile(f){return (/\.dwg$/i).test(f.name||'')||f.type==='image/vnd.dwg'||f.type==='application/acad'||f.type==='application/x-acad'}
async function handleFiles(fileList){const allowed=['application/pdf','image/jpeg','image/png','image/svg+xml'];for(const f of fileList){if(isDWGFile(f)){log(`DWG rozpozn√°n: ${f.name} ‚Äì v t√©to verzi nen√≠ dostupn√° prohl√≠≈æeƒçov√° knihovna. Soubor je ignorov√°n.`,'warn');continue}const isAllowed=allowed.includes(f.type)||(/\.svg$/i).test(f.name);if(!isAllowed){log(`P≈ôeskoƒçeno: ${f.name} ‚Äì nepodporovan√Ω typ pro str√°nky`,'warn');continue}const buf=await f.arrayBuffer();const type=f.type||((/\.svg$/i).test(f.name)?'image/svg+xml':'');const item={id:crypto.randomUUID(),name:f.name,type:type||f.type,data:buf,thumb:null};items.push(item);log(`Naƒçteno: ${f.name}`,'ok');try{if(item.type==='application/pdf'){const pdf=await pdfjsLib.getDocument({data:buf.slice(0)}).promise;const page=await pdf.getPage(1);const viewport=page.getViewport({scale:160/72});const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');canvas.width=Math.max(1,Math.floor(viewport.width));canvas.height=Math.max(1,Math.floor(viewport.height));await page.render({canvasContext:ctx,viewport}).promise;item.thumb=canvas.toDataURL('image/jpeg',.82)}else{item.thumb=await rasterImageToThumb(new Blob([buf],{type:item.type||'image/*'}))}}catch(e){console.warn('Thumbnail error',e)}}refreshUI()}
async function handleAttachments(fileList){for(const f of fileList){const buf=await f.arrayBuffer();const type=f.type||'';attachments.push({id:crypto.randomUUID(),name:f.name,type,data:buf});log(`P≈ôid√°na p≈ô√≠loha: ${f.name}`,'ok')}refreshUI()}
async function rasterImageToThumb(blob){return await new Promise(res=>{const url=URL.createObjectURL(blob);const img=new Image();img.onload=()=>{const c=document.createElement('canvas');const r=Math.min(1,160/Math.max(img.naturalWidth||img.width,img.naturalHeight||img.height||160));c.width=(Math.max(1,(img.naturalWidth||img.width)*r))|0;c.height=(Math.max(1,(img.naturalHeight||img.height)*r))|0;c.getContext('2d').drawImage(img,0,0,c.width,c.height);URL.revokeObjectURL(url);res(c.toDataURL('image/jpeg',.85))};img.onerror=()=>{URL.revokeObjectURL(url);res('')};img.src=url})}
btnClear.addEventListener('click',()=>{items=[];attachments=[];refreshUI();log('Vymaz√°ny seznamy soubor≈Ø i p≈ô√≠loh.')});
btnMerge.addEventListener('click',async ()=>{try{if(items.length===0)return;log('Slouƒçen√≠ zah√°jeno‚Ä¶');const {PDFDocument}=PDFLib;const out=await PDFDocument.create();for(const it of items){if(it.type==='application/pdf'){const src=await PDFDocument.load(it.data.slice(0));const pages=await out.copyPages(src,src.getPageIndices());pages.forEach(p=>out.addPage(p))}}for(const it of items){if(it.type!=='application/pdf'){let emb;if((it.type||'').includes('png')){emb=await out.embedPng(it.data)}else if((it.type||'').includes('svg')){const pngBytes=await svgToPngBytes(it.data);emb=await out.embedPng(pngBytes)}else{emb=await out.embedJpg(it.data)}let pageWidth=emb.width,pageHeight=emb.height;if(fitA4.checked){const A4={w:595.28,h:841.89};const scale=Math.min(A4.w/emb.width,A4.h/emb.height);pageWidth=A4.w;pageHeight=A4.h;const page=out.addPage([pageWidth,pageHeight]);const drawW=emb.width*scale,drawH=emb.height*scale;const x=(pageWidth-drawW)/2,y=(pageHeight-drawH)/2;page.drawImage(emb,{x,y,width:drawW,height:drawH});continue}const page=out.addPage([pageWidth,pageHeight]);page.drawImage(emb,{x:0,y:0,width:pageWidth,height:pageHeight})}}await addAttachments(out);const bytes=await out.save({useObjectStreams:false});const baseName='merged';await maybeEncryptAndSave(bytes,baseName)}catch(err){console.error(err);log('Chyba p≈ôi sluƒçov√°n√≠: '+err.message,'bad')}});
btnCompress.addEventListener('click',async ()=>{try{const quality=parseFloat(jpgQuality.value);const dpiVal=110;const pdfFile=items[0];log(`Komprese: ${pdfFile.name} (JPEG kvalita ${quality})‚Ä¶`);const pdf=await pdfjsLib.getDocument({data:pdfFile.data.slice(0)}).promise;const {PDFDocument}=PDFLib;const out=await PDFDocument.create();for(let i=1;i<=pdf.numPages;i++){const page=await pdf.getPage(i);const viewport=page.getViewport({scale:dpiVal/72});const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d',{willReadFrequently:false});canvas.width=Math.max(1,Math.floor(viewport.width));canvas.height=Math.max(1,Math.floor(viewport.height));await page.render({canvasContext:ctx,viewport}).promise;const dataUrl=canvas.toDataURL('image/jpeg',quality);const imgBytes=dataURLtoUint8Array(dataUrl);const img=await out.embedJpg(imgBytes);const pageRef=out.addPage([canvas.width,canvas.height]);pageRef.drawImage(img,{x:0,y:0,width:canvas.width,height:canvas.height})}await addAttachments(out);const bytes=await out.save({useObjectStreams:false});const baseName=pdfFile.name.replace(/\.pdf$/i,'')+'.compressed';await maybeEncryptAndSave(bytes,baseName)}catch(err){console.error(err);log('Chyba p≈ôi kompresi: '+err.message,'bad')}});
btnSplit.addEventListener('click',async ()=>{try{const pdfFile=items[0];log(`Rozdƒõlen√≠: ${pdfFile.name}‚Ä¶`);const {PDFDocument}=PDFLib;const src=await PDFDocument.load(pdfFile.data.slice(0));const zip=new JSZip();for(let i=0;i<src.getPageCount();i++){const out=await PDFDocument.create();const [copied]=await out.copyPages(src,[i]);out.addPage(copied);const bytes=await out.save({useObjectStreams:false});const fname=`${pdfFile.name.replace(/\.pdf$/i,'')}_p${String(i+1).padStart(3,'0')}.pdf`;zip.file(fname,bytes)}const blob=await zip.generateAsync({type:'blob'});saveAs(blob,pdfFile.name.replace(/\.pdf$/i,'')+'_split.zip');log('Rozdƒõlen√≠ dokonƒçeno a sta≈æeno jako ZIP.','ok')}catch(err){console.error(err);log('Chyba p≈ôi rozdƒõlen√≠: '+err.message,'bad')}});
btnPdfToJpg.addEventListener('click',async ()=>{try{const pdfFile=items[0];const dpiVal=parseInt(dpi.value,10);const quality=parseFloat(jpgQuality.value);log(`Export PDF‚ÜíJPG: ${pdfFile.name} (DPI ${dpiVal}, kvalita ${quality})‚Ä¶`);const pdf=await pdfjsLib.getDocument({data:pdfFile.data.slice(0)}).promise;const zip=new JSZip();for(let i=1;i<=pdf.numPages;i++){const page=await pdf.getPage(i);const viewport=page.getViewport({scale:dpiVal/72});const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');canvas.width=Math.max(1,Math.floor(viewport.width));canvas.height=Math.max(1,Math.floor(viewport.height));await page.render({canvasContext:ctx,viewport}).promise;const dataUrl=canvas.toDataURL('image/jpeg',quality);const bstr=atob(dataUrl.split(',')[1]);const u8=new Uint8Array(bstr.length);for(let j=0;j<bstr.length;j++)u8[j]=bstr.charCodeAt(j);const fname=`${pdfFile.name.replace(/\.pdf$/i,'')}_p${String(i).padStart(3,'0')}.jpg`;zip.file(fname,u8)}const blob=await zip.generateAsync({type:'blob'});saveAs(blob,pdfFile.name.replace(/\.pdf$/i,'')+'_jpg.zip');log('Export dokonƒçen a sta≈æen jako ZIP.','ok')}catch(err){console.error(err);log('Chyba p≈ôi exportu PDF‚ÜíJPG: '+err.message,'bad')}});
btnInfo.addEventListener('click',async ()=>{infoEl.innerHTML='<div class="hint">Naƒç√≠t√°m metadata‚Ä¶</div>';try{const pdfFile=items[0];const u8=new Uint8Array(pdfFile.data);const sizeB=u8.byteLength;const pdf=await pdfjsLib.getDocument({data:u8}).promise;const meta=await pdf.getMetadata().catch(()=>({}));const outline=await pdf.getOutline().catch(()=>null);const atts=await pdf.getAttachments().catch(()=>null);const pages=pdf.numPages;let pageRows='';for(let i=1;i<=pages;i++){const p=await pdf.getPage(i);const v=p.view;const wpt=Math.abs((v&&v.length>=4)?(v[2]-v[0]):p.getViewport({scale:1}).width);const hpt=Math.abs((v&&v.length>=4)?(v[3]-v[1]):p.getViewport({scale:1}).height);const wmm=(wpt*25.4/72).toFixed(1);const hmm=(hpt*25.4/72).toFixed(1);pageRows+=`<div class="kv"><b>Page ${i}</b><span>${wpt|0}√ó${hpt|0} pt (${wmm}√ó${hmm} mm)</span></div>`}const info=(meta&&meta.info)||{};const kvs=[['Soubor',escapeHtml(pdfFile.name)],['Velikost',formatBytes(sizeB)],['Poƒçet stran',String(pages)],['PDF verze',info.PDFFormatVersion||'-'],['Producer',info.Producer||'-'],['Creator',info.Creator||'-'],['Title',info.Title||'-'],['Author',info.Author||'-'],['Subject',info.Subject||'-'],['Keywords',info.Keywords||'-'],['Created',info.CreationDate||'-'],['Modified',info.ModDate||'-'],['IsAcroFormPresent',String(info.IsAcroFormPresent??'-')],].map(([k,v])=>`<div class="kv"><b>${k}</b><span>${escapeHtml(String(v))}</span></div>`).join('');let attHtml='<div class="hint">≈Ω√°dn√© p≈ô√≠lohy.</div>';if(atts&&Object.keys(atts).length){attHtml=Object.keys(atts).map((k,idx)=>{const a=atts[k];const bytes=a.content?new Uint8Array(a.content):new Uint8Array();const url=URL.createObjectURL(new Blob([bytes],{type:a.contentType||'application/octet-stream'}));return `<div class="att"><div><b>${escapeHtml(a.filename||k)}</b><div class="hint">${formatBytes(bytes.byteLength)}</div></div><a class="dl" href="${url}" download="${escapeHtml(a.filename||k)}">St√°hnout</a></div>`}).join('')}let outlineHtml='';if(outline&&outline.length){const items=outline.slice(0,20).map(o=>escapeHtml(o.title||'(bez n√°zvu)')).join(', ');outlineHtml=`<div class="kv"><b>Z√°lo≈æky</b><span>${items}${outline.length>20?' ‚Ä¶':''}</span></div>`}infoEl.innerHTML=`<div class="section-title">INFO</div><div class="info-grid"><div><div class="section-title">Z√°kladn√≠ metadata</div>${kvs}${outlineHtml}</div><div><div class="section-title">Str√°nky</div>${pageRows}</div></div><div class="section-title">P≈ô√≠lohy (Attachments)</div>${attHtml}`;log('INFO: Metadata a p≈ô√≠lohy naƒçteny.','ok')}catch(err){console.error(err);infoEl.innerHTML='<div class="hint">INFO nelze naƒç√≠st: '+escapeHtml(err.message)+'</div>';log('Chyba INFO: '+err.message,'bad')}});
async function addAttachments(pdfDoc){if(!attachments.length)return;try{for(const a of attachments){await pdfDoc.attach(new Uint8Array(a.data),a.name,{mimeType:a.type||undefined})}log(`Vlo≈æeno p≈ô√≠loh: ${attachments.length}`,'ok')}catch(e){console.error(e);log('P≈ôid√°n√≠ p≈ô√≠loh selhalo: '+e.message,'warn')}}
async function maybeEncryptAndSave(bytes,baseName){const protect=optProtect.checked&&(userPwd.value||'').length>0;if(!protect){saveAs(new Blob([bytes],{type:'application/pdf'}),`${baseName}.pdf`);log(`Hotovo: sta≈æen soubor ${baseName}.pdf`,'ok');return}log('≈†ifrov√°n√≠ (AES) p≈ôes QPDF/WASM ‚Äì naƒç√≠t√°m‚Ä¶');let qpdf;try{qpdf=await loadQpdf()}catch(e){log('Nelze naƒç√≠st qpdf-wasm, PDF bude sta≈æeno bez hesla. ('+e.message+')','warn');saveAs(new Blob([bytes],{type:'application/pdf'}),`${baseName}.pdf`);return}try{const inPath='/in.pdf',outPath='/out.pdf';try{qpdf.FS.unlink(inPath)}catch{}try{qpdf.FS.unlink(outPath)}catch{}qpdf.FS.writeFile(inPath,new Uint8Array(bytes));const user=userPwd.value;const owner=(ownerPwd.value&&ownerPwd.value.length>0)?ownerPwd.value:user;const key=(keyLen.value==='128')?'128':'256';const args=['--encrypt',user,owner,key,'--',inPath,outPath];qpdf.callMain(args);const outBytes=qpdf.FS.readFile(outPath);const outName=`${baseName}.secured.pdf`;saveAs(new Blob([outBytes],{type:'application/pdf'}),outName);log(`Hotovo: sta≈æen soubor ${outName} (zaheslov√°no)`,'ok')}catch(e){console.error(e);log('≈†ifrov√°n√≠ selhalo, stahuji nechr√°nƒõnou verzi: '+e.message,'warn');saveAs(new Blob([bytes],{type:'application/pdf'}),`${baseName}.pdf`)}}
let _qpdfModule=null;async function loadQpdf(){if(_qpdfModule)return _qpdfModule;try{const mod=await import('https://cdn.jsdelivr.net/npm/@neslinesli93/qpdf-wasm@0.3.0/dist/index.umd.js');const createModule=mod.default||mod;_qpdfModule=await createModule({locateFile:(p)=>p.endsWith('.wasm')?'https://cdn.jsdelivr.net/npm/@neslinesli93/qpdf-wasm@0.3.0/dist/qpdf.wasm':p,noInitialRun:true});log('QPDF/WASM naƒçten (neslinesli93).','ok');return _qpdfModule}catch(e1){console.warn('qpdf-wasm load 1 failed',e1);try{const mod2=await import('https://cdn.jsdelivr.net/npm/@jspawn/qpdf-wasm@0.0.2/qpdf.mjs');const createModule2=mod2.default||mod2;_qpdfModule=await createModule2({locateFile:(p)=>p.endsWith('.wasm')?'https://cdn.jsdelivr.net/npm/@jspawn/qpdf-wasm@0.0.2/qpdf.wasm':p,noInitialRun:true});log('QPDF/WASM naƒçten (@jspawn).','ok');return _qpdfModule}catch(e2){console.warn('qpdf-wasm load 2 failed',e2);throw new Error('QPDF WASM nen√≠ dostupn√Ω z CDN')}}}
function dataURLtoUint8Array(dataUrl){const bstr=atob(dataUrl.split(',')[1]);const u8=new Uint8Array(bstr.length);for(let i=0;i<bstr.length;i++)u8[i]=bstr.charCodeAt(i);return u8}
function formatBytes(n){if(n<1024)return n+' B';if(n<1024*1024)return(n/1024).toFixed(1)+' KB';if(n<1024*1024*1024)return(n/1024/1024).toFixed(2)+' MB';return(n/1024/1024/1024).toFixed(2)+' GB'}
function cloneBuffer(buf){return buf.slice(0)}
async function svgToPngBytes(arrayBuffer){return await new Promise((resolve,reject)=>{const blob=new Blob([arrayBuffer],{type:'image/svg+xml'});const url=URL.createObjectURL(blob);const img=new Image();img.onload=()=>{const w=Math.max(1,img.naturalWidth||img.width||1000);const h=Math.max(1,img.naturalHeight||img.height||1000);const canvas=document.createElement('canvas');canvas.width=w;canvas.height=h;const ctx=canvas.getContext('2d');ctx.drawImage(img,0,0,w,h);canvas.toBlob((pngBlob)=>{URL.revokeObjectURL(url);if(!pngBlob){reject(new Error('SVG rasterizace selhala'));return}const fr=new FileReader();fr.onload=()=>resolve(new Uint8Array(fr.result));fr.onerror=reject;fr.readAsArrayBuffer(pngBlob)},'image/png',.95)};img.onerror=()=>{URL.revokeObjectURL(url);reject(new Error('SVG nelze naƒç√≠st'))};img.src=url})}
</script></body></html>